<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Modifier mon profil - ISEP Connect</title>
	<link rel="stylesheet" th:href="@{/css/charteGraphique.css}">
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/editProfil.css}">
<script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-dark">

<div th:replace="~{fragments/header :: header-fragment}"></div>

<main class="edit-profile-layout">
	<div class="container-narrow">

		<header class="page-header">
			<h1>Modifier le profil</h1>
			<p>Mettez à jour vos informations pour rester visible auprès de la communauté.</p>
		</header>

		<div class="alert-error" th:if="${error}">
			<i data-lucide="alert-circle"></i> <span th:text="${error}"></span>
		</div>
		<div class="alert-information" th:if="${information}">
			<i data-lucide="check-circle"></i> <span th:text="${information}"></span>
		</div>

		<form th:action="@{/editProfil}" method="post" enctype="multipart/form-data" class="edit-form">

			<section class="form-section card">
				<h3><i data-lucide="image" class="icon-blue"></i> Apparence</h3>

				<div class="photos-management">
					<div class="cover-upload" id="coverTrigger">
						<img id="coverPictureImg"
							  type="image" th:src="@{${userProfile.user.coverPictureUrl}}"></img>
						<div class="overlay"><i data-lucide="camera"></i> Modifier la bannière</div>
							<input id="coverPictureUrl" type="file" name="coverPictureUrl"
								   accept="image/*" style="visibility: hidden">
					</div>

					<div class="profile-pic-upload" id="profileTrigger">
						<div class="avatar-circle">
							<img id="profilePictureImg" type="image" th:src="@{${userProfile.user.profilePictureUrl}}"
								 width="100" height="100"></img>

							<div class="overlay"><i data-lucide="camera"></i></div>
						</div>
						<input type="file"
							   id="profilePictureUrl" name="profilePictureUrl" accept="image/*" style="visibility: hidden">
					</div>
				</div>
			</section>

			<section class="form-section card">
				<h3><i data-lucide="user" class="icon-blue"></i> Informations personnelles</h3>

				<div class="form-grid">
					<div class="input-group">
						<label for="firstName">Prénom *</label>
						<input th:field="*{userProfile.user.firstName}" type="text" id="firstName" required>
					</div>
					<div class="input-group">
						<label for="lastName">Nom *</label>
						<input th:field="*{userProfile.user.lastName}" type="text" id="lastName" required>
					</div>
					<div class="input-group">
						<label for="userGender">Genre</label>
						<select th:field="*{userProfile.profile.userGender}" id="userGender">
							<option value="PREFER_NOT_TO_SAY">Sélectionner</option>
							<option value="MALE">Homme</option>
							<option value="FEMALE">Femme</option>
							<option value="OTHER">Autre</option>
						</select>
					</div>
					<div class="input-group">
						<label for="birthdate">Date de naissance</label>
						<input th:field="*{userProfile.profile.birthdate}" type="date" id="birthdate">
					</div>
					<div class="input-group">
						<label for="location">Ville</label>
						<input th:field="*{userProfile.profile.location}" type="text" id="location" placeholder="Ex: Paris, France">
					</div>
					<div class="input-group">
						<label for="phoneNumber">Téléphone</label>
						<input th:field="*{userProfile.profile.phoneNumber}" type="text" id="phoneNumber">
					</div>
				</div>

				<div class="input-group full-width" style="margin-top: 20px;">
					<label for="bio">Ma Bio</label>
					<textarea th:field="*{userProfile.user.bio}" id="bio" rows="4" placeholder="Parlez un peu de vous..."></textarea>
				</div>
			</section>

			<section class="form-section card">
				<h3><i data-lucide="graduation-cap" class="icon-blue"></i> Études & Travail</h3>
				<div class="form-grid">
					<div class="input-group">
						<label for="isepSpecialization">Spécialisation ISEP</label>
						<select th:field="*{userProfile.profile.isepSpecialization}" id="isepSpecialization">
							<option value="">Choisir...</option>
							<option value="SOFTWARE_ENGINEERING">Génie logiciel</option>
							<option value="DATA_SCIENCE">Data Science</option>
							<option value="CYBERSECURITY">Cybersécurité</option>
							<option value="EMBEDDED_SYSTEMS">Systèmes embarqués</option>
						</select>
					</div>
					<div class="input-group">
						<label for="promoYear">Année de promotion</label>
						<input th:field="*{userProfile.profile.promoYear}" type="number" id="promoYear" min="1950" max="2100">
					</div>
					<div class="input-group">
						<label for="education">Diplôme / Niveau</label>
						<input th:field="*{userProfile.profile.education}" type="text" id="education" placeholder="Ex: Cycle Ingénieur">
					</div>
					<div class="input-group">
						<label for="profession">Poste actuel</label>
						<input th:field="*{userProfile.profile.profession}" type="text" id="profession" placeholder="Ex: Développeur Fullstack">
					</div>
					<div class="input-group full-width">
						<label for="company">Entreprise</label>
						<input th:field="*{userProfile.profile.company}" type="text" id="company">
					</div>
				</div>
			</section>

			<section class="form-section card">
				<h3><i data-lucide="link" class="icon-blue"></i> Liens & Réseaux</h3>
				<div class="form-grid">
				<div class="input-group">
					<label for="website">Portfolio ou Site web</label>
					<div class="input-with-icon">
						<i data-lucide="globe" style="position: absolute; margin: 12px; color: var(--text-dim);"></i>
						<input th:field="*{userProfile.profile.website}" type="url" id="website" placeholder="https://..." style="padding-left: 40px;">
					</div>
				</div>
				<div class="input-group">
					<label for="linkedin">Linkedin</label>
					<div class="input-with-icon">
						<i data-lucide="globe" style="position: absolute; margin: 12px; color: var(--text-dim);"></i>
						<input th:field="*{userProfile.profile.linkedin}" type="url" id="linkedin" placeholder="https://..." style="padding-left: 40px;">
					</div>
				</div>
				<div class="input-group">
					<label for="github">GitHub</label>
					<div class="input-with-icon">
						<i data-lucide="globe" style="position: absolute; margin: 12px; color: var(--text-dim);"></i>
						<input th:field="*{userProfile.profile.github}" type="url" id="github" placeholder="https://..." style="padding-left: 40px;">
					</div>
				</div>
				</div>
			</section>

			<div class="form-actions">
				<button type="button" class="btn-outline" onclick="history.back()">Annuler</button>
				<button type="submit" class="btn-primary-large">Sauvegarder les modifications</button>
			</div>

		</form>
	</div>
</main>

<div th:replace="~{fragments/footer :: footer-fragment}"></div>

<script>
	lucide.createIcons();

	document.getElementById('profileTrigger').onclick = () => document.getElementById('profilePictureUrl').click();
	document.getElementById('coverTrigger').onclick = () => document.getElementById('coverPictureUrl').click();


	function setupPreview(inputId, imgId) {
		const input = document.getElementById(inputId);
		const img = document.getElementById(imgId);
		if(input && img) {
			input.onchange = evt => {
				const [file] = evt.target.files;
				if (file) {
					img.src = URL.createObjectURL(file);
				}
			}
		}
	}
	setupPreview('profilePictureUrl', 'profilePictureImg');
	setupPreview('coverPictureUrl', 'coverPictureImg');
</script>
</body>
</html>