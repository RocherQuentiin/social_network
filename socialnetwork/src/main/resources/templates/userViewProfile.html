<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="${userProfile.user.firstName + ' ' + userProfile.user.lastName + ' - ISEP Connect'}">Profil</title>
	<link rel="stylesheet" th:href="@{/css/charteGraphique.css}">
	<link rel="stylesheet" th:href="@{/css/header.css}">
	<link rel="stylesheet" th:href="@{/css/profil.css}">
	<link rel="stylesheet" th:href="@{/css/friendRequest.css}">
	<script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-dark">

<div th:replace="~{fragments/header :: header-fragment}"></div>

<main class="profil-layout">
	<aside class="sidebar-left">
		<div class="card profile-card">
			<div class="avatar-section">
				<div class="avatar-wrapper">
					<img th:src="@{${userProfile.user.profilePictureUrl != null ? userProfile.user.profilePictureUrl : '/images/default-avatar.png'}}" alt="Avatar">
				</div>
			</div>

			<h2 class="user-fullname" th:text="${userProfile.user.firstName + ' ' + userProfile.user.lastName}">Alexandre Dupont</h2>
			<p class="user-studies" th:text="${userProfile.profile.profession}">Étudiant Ingénieur - ISEP</p>

			<div class="location-tag" th:if="${userProfile.privacySettings.canSeeLocation}">
				<i data-lucide="map-pin"></i>
				<span th:text="${userProfile.profile.location}">Paris, France</span>
			</div>

			<div class="stats-row">
				<div class="stat-box">
					<span class="label">PROMO</span>
					<span class="value text-primary" th:text="${userProfile.profile.promoYear}">2024</span>
				</div>
				<div class="stat-box">
					<span class="label">FILIÈRE</span>
					<span class="value text-primary" th:text="${userProfile.profile.isepSpecialization}">Logiciel</span>
				</div>
			</div>

			<div style="display: flex; flex-direction: column; gap: 10px;">
				<button class="btn-friend-request"
				        th:data-id="${userProfile.user.id}"
				        th:data-action="send">
					Ajouter comme ami
				</button>

				<button id="followBtn"
						class="btn-primary-full"
						th:classappend="${isFollow ? 'unfollow' : 'follow'}"
						th:data-id="${userProfile.user.id}"
						th:text="${isFollow ? 'Ne plus suivre' : 'Suivre'}">
					Suivre
				</button>
				
				<button id="recommandationBtn"
						class="btn-recommandation"
						th:data-id="${userProfile.user.id}">
					Recommandation
				</button>

				<a th:if="${userProfile.privacySettings.allowDirectMessages == 'true'}"
				   th:href="@{/messages(target=${userProfile.user.id})}"
				   class="btn-primary-full"
				   style="background: rgba(255,255,255,0.1); border: 1px solid var(--border);">
					Envoyer un message
				</a>
			</div>
		</div>

		<div class="card networks-card">
			<h3 class="sidebar-title">Réseaux</h3>
			<div class="network-links">
				<a th:if="${userProfile.profile.website}" th:href="${userProfile.profile.website}" target="_blank" class="network-item">
					<div class="item-left"><i data-lucide="globe"></i> <span>Portfolio</span></div>
					<i data-lucide="external-link" class="arrow-right"></i>
				</a>
				<div class="network-item" th:if="${userProfile.privacySettings.canSeeEmail}">
					<div class="item-left"><i data-lucide="mail"></i> <span th:text="${userProfile.user.email}">Email</span></div>
				</div>
			</div>
		</div>
	</aside>

	<section class="main-content">
		<div class="alert-error" th:if="${error}">
			<i data-lucide="alert-circle"></i> <span th:text="${error}"></span>
		</div>
		<div class="alert-information" th:if="${information}">
			<i data-lucide="check-circle"></i> <span th:text="${information}"></span>
		</div>
		<div class="section-container">
			<div class="section-header">
				<h3><i data-lucide="user" class="icon-blue"></i> À propos</h3>
			</div>
			<div class="card box-content">
				<p th:text="${userProfile.user.bio != null ? userProfile.user.bio : 'Cet utilisateur n a pas encore rédigé de bio.'}">Bio...</p>
			</div>
		</div>

		<div class="section-container">
			<div class="section-header">
				<h3><i data-lucide="graduation-cap" class="icon-blue"></i> Formation</h3>
			</div>
			<div class="card box-content">
				<div class="tags-container">
					<span class="tag" th:text="${userProfile.profile.education}">Niveau d'étude</span>
					<span class="tag" th:text="${userProfile.profile.isepSpecialization}">Spécialisation</span>
					<span class="tag" th:text="'Promo ' + ${userProfile.profile.promoYear}">Promo</span>
				</div>
			</div>
		</div>

		<div class="section-container">
			<div class="section-header">
				<h3><i data-lucide="briefcase" class="icon-blue"></i> Expérience Professionnelle</h3>
			</div>
			<div class="projects-grid">
				<div class="card project-item" style="display: flex; align-items: center; padding: 20px; gap: 20px;">
					<div class="plus-circle"><i data-lucide="briefcase"></i></div>
					<div class="project-info" style="padding: 0;">
						<h4 th:text="${userProfile.profile.profession != null ? userProfile.profile.profession : 'En recherche d opportunités'}">Poste</h4>
						<p th:text="${userProfile.profile.company != null ? userProfile.profile.company : 'ISEP'}">Entreprise</p>
					</div>
				</div>
			</div>
		</div>
		
		<div class="section-container">
			<div class="section-header">
				<h3><i data-lucide="star" class="icon-blue"></i> Recommandation</h3>
			</div>
			<div th:each="recommandations : ${listRecommandation}" class="recommandation-grid">
				<div class="card recommandation-item" style="display: flex; align-items: center; padding: 20px; gap: 20px;">
					<div class="plus-circle"><i data-lucide="star"></i></div>
					<div class="project-info" style="padding: 0;">
						<h4><span th:text="${recommandations.score}"></span> / 5.0 par <span th:text="${recommandations.user.firstName}"></span> <span th:text="${recommandations.user.lastName}"></span></h4>
						<p th:text="${recommandations.reason}"></p>
					</div>
				</div>
			</div>
		</div>

		<div class="section-container" th:if="${userProfile.privacySettings.canSeeBirthdate}">
			<div class="section-header">
				<h3><i data-lucide="calendar" class="icon-blue"></i> Informations</h3>
			</div>
			<div class="card box-content">
				<p><strong>Date de naissance :</strong> <span th:text="${userProfile.profile.birthdate}">01/01/2000</span></p>
				<p th:if="${userProfile.privacySettings.canSeePhone}"><strong>Téléphone :</strong> <span th:text="${userProfile.profile.phoneNumber}">Non renseigné</span></p>
			</div>
		</div>
	</section>
	
	<div id="userRecommandationModal">
		<div class="modal-card card">
			<div class="modal-header">
				<h3>Récommandation de l'utilisateur</h3>
				<button id=closeUserRecommandationModal aria-label="Fermer">✕</button>
			</div>
			<div class="modal-body">
				<form th:action="@{/recommandation}" th:object="${recommandation}" method="post"
					class="recommandation-form">
					<input id="userId" name="userRecommandationID"
       				th:value="${userProfile.user.id}" type="text" style="visibility: hidden;" />
					<div class="input-group">
						<label for="score">Visibilité</label> <select
							id="score" class="custom-select"
							th:field="*{score}">
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
						</select>
					</div>

					<div class="input-group">
						<label for="reason">Raison</label>
						<div class="input-wrapper">
							<textarea th:field="*{reason}" id="reason" rows="4" placeholder="Raison"></textarea>
						</div>
					</div>

					<div class="modal-footer">
						<button id="btn-submit" type="submit" class="btn-submit">Créer</button>
					</div>
				</form>

			</div>

		</div>
	</div>
</main>

<div th:replace="~{fragments/footer :: footer-fragment}"></div>

<script th:src="@{/js/header.js}"></script>
<script th:src="@{/js/userViewProfile.js}"></script>
<script th:src="@{/js/friendRequest.js}"></script>
<script>lucide.createIcons();</script>
</body>
</html>