<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fil d'actualité - ISEP Connect</title>
    <link rel="stylesheet" th:href="@{/css/charteGraphique.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/accueil.css}">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <div th:replace="~{fragments/header :: header-fragment}"></div>

    <div class="container container-narrow" style="display:grid; grid-template-columns: 260px 1fr 300px; gap:20px; margin-top:20px;">

        <!-- left sidebar (simple) -->
        <aside>
            <div class="card" style="padding:16px; background:var(--bg-card); border:1px solid var(--border); border-radius:12px;">
                <h4 th:text="${name}">Utilisateur</h4>
                <p>Bienvenue sur votre fil</p>
            </div>
        </aside>

        <!-- main feed -->
        <main>
            <!-- publication form (only if connected) -->
            <div th:if="${session.userId != null}">
                <div class="publish-card" style="margin-bottom:18px;">
                    <div class="publish-inner" style="display:flex; gap:12px; align-items:flex-start;">
                        <div class="avatar-box">
                            <img th:src="@{/images/default-avatar.png}" alt="avatar" style="width:48px; height:48px; border-radius:50%; object-fit:cover;"/>
                        </div>
                        <form th:action="@{/post}" method="post" class="publish-form" style="flex:1;">
                            <input type="hidden" name="allowComments" value="false" />
                            <textarea name="content" placeholder="Quoi de neuf ?" rows="2"></textarea>
                            <div style="display:flex; gap:12px; align-items:center; margin-top:10px;">
                                <select id="visibilityType" name="visibilityType" class="publish-visibility">
                                    <option value="PUBLIC">Public</option>
                                    <option value="FRIENDS">Amis</option>
                                    <option value="PRIVATE">Privé</option>
                                </select>
                                <label style="display:flex; align-items:center; gap:6px;"><input type="checkbox" name="allowComments" value="true" checked /> Autoriser les commentaires</label>
                                <button type="submit" class="btn-primary">Publier</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- posts list -->
            <div>
                <div th:each="post : ${posts}" class="card" style="margin-bottom:12px; padding:16px; background:var(--bg-card); border:1px solid var(--border); border-radius:12px;">
                    <div style="display:flex; gap:12px; align-items:flex-start;">
                        <div style="width:48px;">
                            <img th:src="@{/images/default-avatar.png}" alt="avatar" style="width:48px; height:48px; border-radius:50%; object-fit:cover;"/>
                        </div>
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <strong th:text="${post.author.username}">Auteur</strong>
                                    <div style="font-size:0.85rem; color:var(--text-dim);" th:text="${post.createdAt}">date</div>
                                </div>
                                <div style="font-size:0.85rem; color:var(--text-dim);" th:text="${post.visibilityType}">VIS</div>
                            </div>
                            <p style="margin-top:8px;" th:text="${post.content}">Contenu du post</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- right sidebar (simple) -->
        <aside>
            <div class="card" style="padding:16px; background:var(--bg-card); border:1px solid var(--border); border-radius:12px;">
                <h4>Annonces</h4>
                <p>Événements récents et topics</p>
            </div>
        </aside>

    </div>

    <div th:replace="~{fragments/footer :: footer-fragment}"></div>
    <script th:src="@{/js/header.js}"></script>
    <script>lucide.createIcons();</script>
</body>
</html>
